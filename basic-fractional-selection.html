<link rel="import" href="components/polymer/polymer.html">

<polymer-element name="basic-fractional-selection">
<script>
Polymer({

  next: function() {
    var index = Math.floor(this.selectedIndex) + 1;
    this.snap(index);
  },

  publish: {
    maximum: {
      reflect: true,
      value: null
    },
    minimum: {
      reflect: true,
      value: 0
    },
    selectedIndex: {
      reflect: false,
      value: 0
    }
  },

  maximumChanged: function() {
    this._selectIndexWithinBounds(this.selectedIndex);
  },

  minimumChanged: function() {
    this._selectIndexWithinBounds(this.selectedIndex);
  },

  previous: function() {
    var index = Math.ceil(this.selectedIndex) - 1;
    this.snap(index);
  },

  selectedIndexChanged: function() {
    var index = this.selectedIndex;
    var event = new CustomEvent('basic-selection-changed', {
      bubbles: true,
      // HACK
      detail: {
        canGoPrevious: (index > this.minimum),
        canGoNext: (index < this.maximum),
        index: index
      }
    });
    this.dispatchEvent(event);
  },

  // Set the selectedIndex to the given value, ensuring it is within any
  // currently-specified minimum and maximum.
  _selectIndexWithinBounds: function(index) {
    if (this.minimum != null) {
      index = Math.max(index, this.minimum);
    }
    if (this.maximum != null) {
      index = Math.min(index, this.maximum);
    }
    // this.selectedIndex = index;
    this._setSelectedIndex(index);
    return index;
  },

  // Expose a "protected" setter that subclasses can use to do work when the
  // index is changing, without having to wait for an selectedIndexChanged
  // handler to be invoked.
  // REVIEW: This was necessary in Polymer 0.5 in order to reduce jank during
  // touch drags. When Polymer 0.8 is released, see if this is still necessary.
  _setSelectedIndex: function(index) {
    this.selectedIndex = index;
  },

  /*
   * Round to the nearest integer index within bounds.
   */
  snap: function(index) {
    index = index != null ?
      index :
      Math.round(this.selectedIndex);
    return this._selectIndexWithinBounds(index);
  }

});
</script>
</polmyer-element>
