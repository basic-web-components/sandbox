<link rel="import" href="../basic-selector.html">

<polymer-element name="basic-cursor-key-navigator" extends="basic-selector">
<script>
Polymer(BasicComposition.compose({

  ready: function() {
    this.addEventListener('focus', function() {
      console.log("basic-selector: focus");
    });
    // TODO: Move to attached(). Do we need to stop listening when detached?
    this.addEventListener('keydown', function(event) {
      return this._keydown(event);
    }.bind(this));

    this.addFocusIndicatorStyles();
    // this.makeFocusable();
  },

  _keydown: function(event) {

    console.log("basic-cursor-key-navigator: keydown " + event.keyCode);

    var handled = false;
    var previousIndex = this.selectedIndex; // HACK: see below.
    
    switch (event.keyCode) {
      case 35: // End
        handled = this.selectLast();
        break;
      case 36: // Home
        handled = this.selectFirst();
        break;
      case 37: // Left
        if (this._selectedItemIsInline()) {
          handled = this.selectPrevious();
        }
        break;
      case 38: // Up
        handled = event.altKey ? this.selectFirst() : this.selectPrevious();
        break;
      case 39: // Right
        if (this._selectedItemIsInline()) {
          handled = this.selectNext();
        }
        break;
      case 40: // Down
        handled = event.altKey ? this.selectLast() : this.selectNext();
        break;
    }

    // HACK until BasicSelection can tell us whether selection actually changed.
    if (this.selectedIndex !== previousIndex) {
      handled = true;
    }

    if (handled) {
      event.preventDefault();
      event.stopPropagation();
      return false;
    }
  },

  // Return true if the selected control is displayed inline.
  _selectedItemIsInline: function() {
    var selectedItem = this.selectedItem;
    if (!selectedItem) {
      return false;
    }
    var style = getComputedStyle(selectedItem);
    var inlineDisplayValues = ['inline', 'inline-block', 'inline-table'];
    var itemIsInline = (inlineDisplayValues.indexOf(style.display) >= 0);
    return itemIsInline;
  },

}, BasicAccessibility));
</script>
</polymer-element>
