<link rel="import" href="../basic-aspect/basic-aspect.html">

<polymer-element name="basic-direction-navigation-aspect" extends="basic-aspect">
<script>
Polymer(

  ready: function() {
    this.addEventListener('focus', function() {
      console.log("basic-direction-navigation-aspect: focus");
    });
    // TODO: Move to attached(). Do we need to stop listening when detached?
    this.addEventListener('keydown', function(event) {
      return this._keydown(event);
    }.bind(this));

    // this.addFocusIndicatorStyles();
    // this.makeFocusable();
  },

  _keydown: function(event) {

    console.log("basic-cursor-key-navigator: keydown " + event.keyCode);

    var handled = false;
    var previousIndex = this.aspect.selectedIndex; // HACK: see below.
    
    switch (event.keyCode) {
      case 35: // End
        handled = this.aspect.selectLast();
        break;
      case 36: // Home
        handled = this.aspect.selectFirst();
        break;
      case 37: // Left
        if (this._selectedItemIsInline()) {
          handled = this.aspect.selectPrevious();
        }
        break;
      case 38: // Up
        handled = event.altKey ? this.aspect.selectFirst() : this.aspect.selectPrevious();
        break;
      case 39: // Right
        if (this._selectedItemIsInline()) {
          handled = this.aspect.selectNext();
        }
        break;
      case 40: // Down
        handled = event.altKey ? this.aspect.selectLast() : this.aspect.selectNext();
        break;
    }

    // HACK until basic-selection-aspect can tell us whether selection actually changed.
    if (this.aspect.selectedIndex !== previousIndex) {
      handled = true;
    }

    if (handled) {
      event.preventDefault();
      event.stopPropagation();
      return false;
    }
  },

  // Return true if the selected control is displayed inline.
  _selectedItemIsInline: function() {
    var selectedItem = this.aspect.selectedItem;
    if (!selectedItem) {
      return false;
    }
    var style = getComputedStyle(selectedItem);
    var inlineDisplayValues = ['inline', 'inline-block', 'inline-table'];
    var itemIsInline = (inlineDisplayValues.indexOf(style.display) >= 0);
    return itemIsInline;
  },

});
</script>
</polymer-element>
