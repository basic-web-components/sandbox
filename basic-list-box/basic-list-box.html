<link rel="import" href="../basic-selector.html">
<link rel="import" href="../basic-cursor-key-navigator/basic-cursor-key-navigator.html">

<polymer-element name="basic-list-box" extends="basic-selector">
<template>
  <style>
  :host {
    display: block;
    /*outline: none;*/
    -webkit-overflow-scrolling: touch;
    overflow-y: scroll; /* for momentum scrolling */
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  }

  basic-cursor-key-navigator {
    display: block;
    outline: none;
  }

  /* Generic appearance */
  :host([generic=""]) {
    border: 1px solid gray;
    box-sizing: border-box;
    cursor: default;
  }

  polyfill-next-selector {
    content: ':host([generic=""]) > *';
  }
  :host([generic=""]) ::content > * {
    padding: 0.25em;
  }

  polyfill-next-selector {
    content: ':host([generic=""]) > .selected';
  }
  :host([generic=""]) ::content > .selected {
    background: highlight;
    color: highlighttext;
  }  </style>
  
  <!-- Need to figure out which element should have focus. -->
  <basic-cursor-key-navigator id="navigator" tabindex="0">
    <content></content>
  </basic-cursor-key-navigator>

</template>
<script>
Polymer(BasicComposition.compose({

  ready: function() {
    // TODO: How to have BasicDecorator find a default target in shadow?
    this.target = this.$.navigator;

    this.addEventListener('focus', function() {
      console.log("basic-list-box: focus");
      // Forward focus to navigator.
      // this.$.navigator.focus();
    }.bind(this));
    this.addEventListener('keydown', function(event) {
      console.log("basic-list-box: keydown " + event.keyCode);
      // if (!event.forwarded) {
      //   this._forwardKeyboardEvent(this.$.navigator, event);      
      // }
    }.bind(this), true);

    this.addFocusIndicatorStyles();

    if (this.getAttribute('generic') == null) {
      this.generic = true;
    }
  },

  publish: {
    generic: {
      value: null,
      reflect: true
    }
  },

  // If we end up needing to do this, it's a mess. See
  // http://stackoverflow.com/questions/10455626/keydown-simulation-in-chrome-fires-normally-but-not-the-correct-key/14561303#14561303
  _forwardKeyboardEvent: function(element, originalEvent) {
    // var event = new KeyboardEvent(originalEvent.type, {
    //   key: originalEvent.key,
    //   code: originalEvent.code,
    //   location: originalEvent.location,
    //   ctrlKey: originalEvent.ctrlKey,
    //   shiftKey: originalEvent.shiftKey,
    //   altKey: originalEvent.altKey,
    //   metaKey: originalEvent.metaKey,
    //   repeat: originalEvent.repeat,
    //   isComposing: originalEvent.isComposing,
    //   charCode: originalEvent.charCode,
    //   keyCode: originalEvent.keyCode,
    //   which: originalEvent.which
    // });
    var event = document.createEvent('KeyboardEvent');
    var initMethod = typeof event.initKeyboardEvent !== 'undefined' ?
      'initKeyboardEvent' :
      'initKeyEvent';

    event[initMethod](
                    originalEvent.type,
                    true, // bubbles
                    true, // cancelable
                    window, // viewArg: should be window
                    originalEvent.ctrlKey,
                    originalEvent.altKey,
                    originalEvent.shiftKey,
                    originalEvent.metaKey,
                    originalEvent.keyCode,
                    originalEvent.charCode
    );
    event.forwarded = true;
    element.dispatchEvent(event);
  }

}, BasicAccessibility));
</script>
</polymer-element>
