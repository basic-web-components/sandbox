<link rel="import" href="../basic-aspect/basic-aspect.html">
<script src="BasicContentHelpers.js"></script>

<!--
TODO: Don't respond to changes in attributes, or at least offer that as an
option.
-->

<polymer-element name="basic-children-content" extends="basic-aspect">
<script>
Polymer({

  contribute: {

    collectiveChanged: function() {
      // console.log("collectiveChanged: " + this.collective.aspects.length);
      var innermost = this.collective.innermost;
      if (innermost === this._previousInnermostAspect) {
        // We should already be observing changes on the innermost aspect.
        return;
      }
      // A new aspect is now innermost.
      if (this._previousInnermostAspect && this._previousInnermostAspect._contentChangeObserver) {
        // Stop observing changes on the old innermost aspect.
        // console.log("stopping observation of changes on old innermost aspect");
        BasicContentHelpers.observeContentChanges.call(this._previousInnermostAspect, false);
      }
      // Start observing changes on the new innermost aspect.
      if (innermost._contentChangeObserver) {
        // console.log("already being observed");
      }
      BasicContentHelpers.observeContentChanges.call(innermost);
      this._previousInnermostAspect = innermost;
    },

    contentChanged: function() {
      // TODO: Raise event?

      // Reset memoized content.
      this._content = null;
    },

    get content() {
      if (!this._content) {
        this._content = BasicContentHelpers.flattenChildren(this.collective.innermost);
      }
      return this._content;
    }

  },

  // Memoized content
  _content: null,

  _previousInnermostAspect: null

});
</script>
</polymer-element>
