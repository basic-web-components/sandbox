<link rel="import" href="../components/polymer/polymer.html">
<script src="../collectives/Collective.js"></script>

<script>
Polymer({

  assimilate: function(target) {
    this.collective.assimilate(target);
  },

  contribute: {
    // The basic-aspect basic class contributes no members itself, but defines
    // a contribute property so that it (and any subclass) is recognizable as an
    // aspect.
  },

  created: function() {
    new Collective(this);
  },

  is: 'basic-aspect',

  publish: {
    target: {
      reflect: false,
      value: null
    }
  },

  targetChanged: function() {
    // Handle special string value "child".
    // TODO: Handle "next".
    // TODO: Handle "shadow".
    var target;
    if (this.target === 'child') {
      target = this._firstChildAspect();
    } else {
      target = this.target;
    }
    if (target) {
      this.assimilate(target);
    }
  },

  // Return the first child with a "contribute" property.
  _firstChildAspect: function() {
    var children = this.children;
    var firstChildAspect;
    for (var i = 0, length = children.length; i < length; i++) {
      var child = children[i];
      if (child.contribute) {
        return child;
      }
    }
    return null;
  }

});
</script>
