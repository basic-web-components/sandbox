<link rel="import" href="../basic-aspect/basic-aspect.html">

<link rel="import" href="../basic-swipe-navigation/basic-swipe-navigation.html">
<link rel="import" href="../basic-selection-navigation/basic-selection-navigation.html">
<link rel="import" href="../basic-selection-aspect/basic-selection-aspect.html">
<link rel="import" href="../basic-content-items-aspect/basic-content-items-aspect.html">
<link rel="import" href="../basic-spread-items/basic-spread-items.html">

<polymer-element name="basic-carousel" extends="basic-aspect">
<template>
  <style>
  :host {
    display: -webkit-flex;
    display: flex;
  }

  basic-swipe-navigation,
  basic-selection-navigation,
  basic-selection-aspect,
  basic-content-items-aspect,
  basic-spread-items {
    display: -webkit-flex;
    display: flex;
    -webkit-flex: 1;
    flex: 1;
  }
  </style>
  <basic-swipe-navigation id="target">
    <basic-selection-navigation>
      <basic-selection-aspect>
        <basic-content-items-aspect id="contentItems">
          <basic-spread-items id="spread">
            <content id="content"></content>
          </basic-spread-items>
        </basic-content-items-aspect>
      </basic-selection-aspect>
    </basic-selection-navigation>
  </basic-swipe-navigation>
</template>
<script>
Polymer({

  attached: function() {
    // TODO: Figure out why this doesn't happen by default.
    this.$.contentItems.innerAspect = this.$.spread;

    this.innerAspect = this.$.target;
  },

  contentChanged: function() {
    if (this.itemsChanged) {
      this.itemsChanged();
    }
  },

  contribute: {

    // HACK until basic-content-items-aspect can handle content distribution
    // on the innermost aspect.
    get items() {
      var nodes = this.$.content.getDistributedNodes();
      return [].filter.call(nodes, function(node) {
        return node instanceof HTMLElement;
      });
    }

  },

  ready: function() {
    // HACK. See comment at items getter.
    var handler = this.contentChanged.bind(this);
    this._contentChangeObserver = new MutationObserver(handler);
    this._contentChangeObserver.observe(this, {
      childList: true
    });
    handler();
  }

});
</script>
</polymer-element>
